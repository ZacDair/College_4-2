<!doctype html>
<html lang="en">
  <head>
	<meta charset="utf-8">
	<title>COMP8054 W5 Lab</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.5.0/d3.min.js " type="text/JavaScript"></script>
	
    <style>
    </style>
  </head>
  
  
  <body id="theBody">
	
	<h3>Dynamic Circle Chart</h3>
	<div id="div1">
		<script>
		function readDataFromFile(key){
			// Read in the csv file
			d3.csv("worldcup.csv", d3.autoType).then(function(data){
				if (key == null){
					key = "win"
					createSoccerViz(data, key);
					createControlButtons(data);
				}
				else{
					updateSoccerViz(data, key);
				}
			}).catch(function(error){
				// handle error
				console.log(error);				
			});
		}
		
		// Read data from the files and ouput to console log
		readDataFromFile();
		
		// Display the data from the dataset
		function createSoccerViz(ourData, valueName){
			var bodySelection = d3.select("#div1");
			for (index in ourData){
				if (index < ourData.length){
					var svgSelection = bodySelection.append("svg")
										.attr("width", 100)
										.attr("height", 120);

					var circleSelection = svgSelection.append("circle")
											  .attr("id", "circle"+index)
											  .attr("cx", 50)
											  .attr("cy", 50)
											  .attr("r", ourData[index][valueName]*5)
											  .style("fill", "#7d9ed1");
											  
					var textSelection = svgSelection.append("text")
											  .attr("x", 50)
											  .attr("y", 100)
											  .attr("text-anchor", "middle")
											  .text(ourData[index]["team"]);
				}
			}
		}
		
		
		function createControlButtons(data){
			var bodySelection = d3.select("#div1");
			bodySelection.append("br");
			for (index in Object.keys(data[0])){
				if (index > 1){
					let functionName = "readDataFromFile('" + Object.keys(data[0])[index] + "')"
					var buttonSelection = bodySelection.append("button")
											.attr("onclick", functionName)
											.text(Object.keys(data[0])[index]);
				}
			}
		}
		
		function updateSoccerViz(data, key){
			for (index in data){
				if (index < data.length){
					var circle = d3.select("#circle" + index);
					circle.attr("r", data[index][key]*5);
				}
			}
		}
		</script>
	</div>
	
	<h3>Worldcup Wins By Team Bar Chart</h3>
	<p> A simplistic bar chart, to display the total wins of each team </p>
	<div id="div2">
	<script>
		d3.csv("worldcup.csv", d3.autoType).then(function(data){
			createWinChart(data);
		}).catch(function(error){
			// handle error
			console.log(error);				
		});
		
		function createWinChart(data){
			console.log(data);
			
			width = 500
			height = 500
			
			var xScale = d3.scaleBand().range ([0, width-100]).padding(0.2);
			var yScale = d3.scaleLinear().range ([height-100, 0]);
			 
			xScale.domain(data.map(function(d) { return d.team; }));
			yScale.domain([0, d3.max(data, function(d) { return d.win; })]);
				
			const svg = d3.select("#div2").append("svg")
				.attr("width", width)
				.attr("height", height)
				.attr("font-family", "sans-serif")
				.attr("font-size", "10")
				.attr("text-anchor", "end");

			const g = svg.append("g")
				  .attr("transform", "translate(" + 40 + "," + 40 + ")");

			g.append("g")
				.attr("transform", "translate(0," + 400 + ")")
				.call(d3.axisBottom(xScale));

			g.append("g")
				.call(d3.axisLeft(yScale).tickFormat(function(d){
					return d;
				}).ticks(5));
			
			g.selectAll(".g")
				.data(data)
				.enter().append("rect")
				.attr("class", "g")
				.style("fill", "#7d9ed1")
				.attr("x", function(d) { return xScale(d.team); })
				.attr("y", function(d) { return yScale(d.win); })
				.attr("width", xScale.bandwidth())
				.attr("height", function(d) { return height- 100 - yScale(d.win); });
		}
	</script>
	</div>
	
	<h3>Worldcup Wins VS Losses By Team Scatter Graph</h3>
	<p> A scatter graph, displaying the position of each team on a 2D plane where the x axis represents the wins and y axis represnts the losses<br>
		Additionally, the radius displays the amount of games, and the color is used to distinguise between teams</p>
	<div id="div3">
	<script>
		d3.csv("worldcup.csv", d3.autoType).then(function(data){
			createScatterGraph(data);
		}).catch(function(error){
			// handle error
			console.log(error);				
		});
		
		function createScatterGraph(data){
			var bodySelection = d3.select("#div3");
			
			width = 500
			height = 500
			
			var xScale = d3.scaleLinear().range ([0, width-100]);
			var yScale = d3.scaleLinear().range ([height-100, 0]);
			
			const colorValue = d => d.team;
			const colorScale = d3.scaleOrdinal().range(d3.schemeCategory10);
			 
			xScale.domain([0, d3.max(data, function(d) { return d.win; })]);
			yScale.domain([0, d3.max(data, function(d) { return d.loss; })]);
				
			const svg = bodySelection.append("svg")
				.attr("width", width)
				.attr("height", height)
				.attr("font-family", "sans-serif")
				.attr("font-size", "10")
				.attr("text-anchor", "end");

			const g = svg.append("g")
				  .attr("transform", "translate(" + 40 + "," + 40 + ")");

			g.append("g")
				.attr("transform", "translate(0," + 400 + ")")
				.call(d3.axisBottom(xScale).tickFormat(function(d){
					return d;
				}).ticks(5));

			g.append("g")
				.call(d3.axisLeft(yScale).tickFormat(function(d){
					return d;
				}).ticks(5));
			
			g.selectAll(".g")
				.data(data)
				.enter().append("circle")
				.attr("class", "g")
				.attr('fill', d => colorScale(colorValue(d)))
				.attr("r", function(d) { return d.win + d.loss + d.draw; })
				.attr("cx", function(d) { return xScale(d.win); })
				.attr("cy", function(d) { return yScale(d.loss); });

		}
		

	</script>
	
	</div>
	
  </body>
  
</html>
